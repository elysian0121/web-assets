<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>星際單字防衛戰</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #050510; font-family: sans-serif; touch-action: manipulation; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        canvas { display: block; width: 100%; flex: 1; background: radial-gradient(circle, #101030 0%, #050510 100%); }
        #ui-layer { position: absolute; top: 10px; left: 10px; color: #00f2ff; pointer-events: none; z-index: 10; }
        #virtual-keyboard { width: 100%; background: #0a0a1e; padding: 10px 0; display: flex; flex-direction: column; gap: 5px; border-top: 2px solid #00f2ff; }
        .keyboard-row { display: flex; justify-content: center; gap: 4px; }
        .key { background: rgba(0, 242, 255, 0.1); border: 1px solid #00f2ff; color: #00f2ff; width: 35px; height: 45px; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 4px; }
        #message-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; background: rgba(0,0,0,0.9); padding: 30px; border: 2px solid #00f2ff; border-radius: 15px; z-index: 100; }
        button { background: #00f2ff; border: none; padding: 10px 20px; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        #current-input-display { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); color: #fff; font-size: 30px; text-shadow: 0 0 10px #00f2ff; z-index: 5; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="ui-layer">
        <div>分數: <span id="score-val">0</span></div>
        <div>生命: <span id="health-val">5</span></div>
    </div>
    <div id="current-input-display"></div>
    <div id="message-box">
        <h1 id="msg-title">準備好了嗎？</h1>
        <button id="start-btn">開始遊戲</button>
    </div>
    <div id="virtual-keyboard">
        <div class="keyboard-row">
            <div class="key" onclick="handleInput('q')">Q</div><div class="key" onclick="handleInput('w')">W</div><div class="key" onclick="handleInput('e')">E</div><div class="key" onclick="handleInput('r')">R</div><div class="key" onclick="handleInput('t')">T</div>
            <div class="key" onclick="handleInput('y')">Y</div><div class="key" onclick="handleInput('u')">U</div><div class="key" onclick="handleInput('i')">I</div><div class="key" onclick="handleInput('o')">O</div><div class="key" onclick="handleInput('p')">P</div>
        </div>
        <div class="keyboard-row">
            <div class="key" onclick="handleInput('a')">A</div><div class="key" onclick="handleInput('s')">S</div><div class="key" onclick="handleInput('d')">D</div><div class="key" onclick="handleInput('f')">F</div><div class="key" onclick="handleInput('g')">G</div>
            <div class="key" onclick="handleInput('h')">H</div><div class="key" onclick="handleInput('j')">J</div><div class="key" onclick="handleInput('k')">K</div><div class="key" onclick="handleInput('l')">L</div>
        </div>
        <div class="keyboard-row">
            <div class="key" onclick="handleInput('z')">Z</div><div class="key" onclick="handleInput('x')">X</div><div class="key" onclick="handleInput('c')">C</div><div class="key" onclick="handleInput('v')">V</div>
            <div class="key" onclick="handleInput('b')">B</div><div class="key" onclick="handleInput('n')">N</div><div class="key" onclick="handleInput('m')">M</div>
        </div>
    </div>
</div>

<script>
    // --- 【重點單字設定】 ---
    const vocabSequence = ["Willy", "loves", "math", "and", "enjoys", "going", "out", "to", "play", "with", "Nana"];
    let seqIdx = 0;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score-val');
    const healthEl = document.getElementById('health-val');
    const inputDisplay = document.getElementById('current-input-display');
    const msgBox = document.getElementById('message-box');
    const startBtn = document.getElementById('start-btn');

    let score = 0, health = 5, gameActive = false, enemies = [], targetEnemy = null, currentInput = "", spawnTimer = 0;

    function resize() { canvas.width = window.innerWidth; canvas.height = canvas.clientHeight; }
    window.addEventListener('resize', resize);
    resize();

    class Enemy {
        constructor(word) {
            this.word = word;
            this.x = Math.random() * (canvas.width - 100) + 50;
            this.y = -20;
            this.speed = 0.8 + (score / 1000);
        }
        update() {
            this.y += this.speed;
            if (this.y > canvas.height) { health--; healthEl.textContent = health; if(health <= 0) endGame(); return true; }
            return false;
        }
        draw() {
            ctx.fillStyle = targetEnemy === this ? "#00f2ff" : "#ffffff";
            ctx.font = "bold 24px Courier New";
            ctx.textAlign = "center";
            ctx.fillText(this.word, this.x, this.y);
            // 顯示已打出的部分
            if (targetEnemy === this) {
                ctx.fillStyle = "#ff00ff";
                ctx.fillText(this.word.substring(0, currentInput.length), this.x, this.y);
            }
        }
    }

    function handleInput(char) {
        if (!gameActive) return;
        const key = char.toLowerCase();
        if (!targetEnemy) {
            targetEnemy = enemies.find(e => e.word.toLowerCase().startsWith(key));
            if (targetEnemy) currentInput = targetEnemy.word[0];
        } else {
            if (targetEnemy.word[currentInput.length].toLowerCase() === key) {
                currentInput += targetEnemy.word[currentInput.length];
            }
        }
        inputDisplay.textContent = currentInput.toUpperCase();
        if (targetEnemy && currentInput === targetEnemy.word) {
            score += 10; scoreEl.textContent = score;
            enemies = enemies.filter(e => e !== targetEnemy);
            targetEnemy = null; currentInput = ""; inputDisplay.textContent = "";
        }
    }

    window.addEventListener('keydown', (e) => { if(e.key.length === 1) handleInput(e.key); });

    function update() {
        if (!gameActive) return;
        spawnTimer++;
        if (spawnTimer > 120) {
            enemies.push(new Enemy(vocabSequence[seqIdx]));
            seqIdx = (seqIdx + 1) % vocabSequence.length;
            spawnTimer = 0;
        }
        enemies = enemies.filter(e => !e.update());
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        enemies.forEach(e => e.draw());
        requestAnimationFrame(() => { update(); draw(); });
    }

    function endGame() { gameActive = false; msgBox.style.display = "block"; document.getElementById('msg-title').textContent = "得分: " + score; }

    startBtn.onclick = () => {
        score = 0; health = 5; seqIdx = 0; enemies = []; targetEnemy = null; currentInput = "";
        scoreEl.textContent = "0"; healthEl.textContent = "5";
        gameActive = true; msgBox.style.display = "none";
    };

    draw();
</script>
</body>
</html>
